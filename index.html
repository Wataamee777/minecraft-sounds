<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Minecraft Sounds Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    font-family: system-ui, sans-serif;
    margin: 20px;
    background: #0f1115;
    color: #eaeaf0;
  }

  h1 { margin-bottom: 10px; }

  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 12px;
    flex-wrap: wrap;
    align-items: center;
  }

  input, select, button {
    padding: 6px 8px;
    font-size: 14px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #151822;
  }

  th, td {
    border: 1px solid #2a2f45;
    padding: 6px 8px;
  }

  th { background: #1c2030; }

  tr:hover { background: #1f2440; }

  audio { width: 170px; }

  .pager {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .count {
    margin-left: auto;
    opacity: 0.8;
  }
</style>
</head>

<body>
<h1>üéÆ Minecraft Sounds</h1>

<div class="controls">
  <input id="search" placeholder="ÂêçÂâç / „Çø„Ç∞Ê§úÁ¥¢">
  <select id="tagFilter">
    <option value="">„Åô„Åπ„Å¶„ÅÆ„Çø„Ç∞</option>
  </select>
</div>

<table>
  <thead>
    <tr>
      <th>ÂêçÂâç</th>
      <th>„Çø„Ç∞</th>
      <th>ÂÜçÁîü / DL</th>
    </tr>
  </thead>
  <tbody id="list"></tbody>
</table>

<div class="pager">
  <button id="prev">‚óÄ Ââç</button>
  <span id="pageInfo"></span>
  <button id="next">Ê¨° ‚ñ∂</button>
  <div class="count" id="count"></div>
</div>

<script>
const PAGE_SIZE = 200;

let sounds = [];
let filtered = [];
let page = 1;

fetch("data/sounds.json")
  .then(r => r.json())
  .then(data => {
    sounds = data;
    initTags(data);
    applyFilter();
  });

function initTags(data) {
  const tags = [...new Set(data.map(s => s.tag))].sort();
  const sel = document.getElementById("tagFilter");
  for (const t of tags) {
    const o = document.createElement("option");
    o.value = t;
    o.textContent = t;
    sel.appendChild(o);
  }
}

document.getElementById("search").addEventListener("input", () => {
  page = 1;
  applyFilter();
});

document.getElementById("tagFilter").addEventListener("change", () => {
  page = 1;
  applyFilter();
});

document.getElementById("prev").onclick = () => {
  if (page > 1) {
    page--;
    render();
  }
};

document.getElementById("next").onclick = () => {
  if (page < maxPage()) {
    page++;
    render();
  }
};

function applyFilter() {
  const q = document.getElementById("search").value.toLowerCase();
  const tag = document.getElementById("tagFilter").value;

  filtered = sounds.filter(s =>
    (!q || s.name.toLowerCase().includes(q) || s.tag.toLowerCase().includes(q)) &&
    (!tag || s.tag === tag)
  );

  render();
}

function maxPage() {
  return Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
}

function render() {
  const tbody = document.getElementById("list");
  tbody.innerHTML = "";

  const start = (page - 1) * PAGE_SIZE;
  const end = start + PAGE_SIZE;

  for (const s of filtered.slice(start, end)) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${s.name}</td>
      <td>${s.tag}</td>
      <td>
        <audio controls preload="none">
          <source src="${s.path}" type="audio/mpeg">
        </audio>
        <a href="${s.path}" download>‚¨á</a>
      </td>
    `;
    tbody.appendChild(tr);
  }

  document.getElementById("pageInfo").textContent =
    `Page ${page} / ${maxPage()}`;

  document.getElementById("count").textContent =
    `${filtered.length} ‰ª∂`;
}
</script>

</body>
</html>
