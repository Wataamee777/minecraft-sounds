name: Generate sounds.json

permissions:
  contents: write

on:
  push:
    paths:
      - "sounds/**"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate sounds.json (inline bash)
        run: |
          set -e

          ROOT="sounds"
          OUT="data/sounds.json"

          mkdir -p data
          echo "[" > "$OUT"

          first=true

          while read -r file; do
            rel="${file#$ROOT/}"
            name="$(basename "$file" .mp3)"
            rawTag="${rel%%/*}"

            case "$rawTag" in
              ambient) tag="環境音" ;;
              armor) tag="防具" ;;
              block) tag="ブロック" ;;
              bottle) tag="瓶" ;;
              bubbles) tag="泡" ;;
              bucket) tag="バケツ" ;;
              camera) tag="カメラ" ;;
              cave) tag="洞窟" ;;
              component) tag="コンポーネント" ;;
              crossbow) tag="クロスボウ" ;;
              damage) tag="ダメージ" ;;
              dig) tag="採掘" ;;
              elytra) tag="エリトラ" ;;
              enchant) tag="エンチャント" ;;
              event) tag="イベント" ;;
              fireworks) tag="花火" ;;
              fire) tag="火" ;;
              item) tag="アイテム" ;;
              jump) tag="ジャンプ" ;;
              lead) tag="リード" ;;
              leashknot) tag="リード結び目" ;;
              liquid) tag="液体" ;;
              minecart) tag="トロッコ" ;;
              mob) tag="モブ" ;;
              note) tag="音ブロック" ;;
              particle) tag="パーティクル" ;;
              portal) tag="ポータル" ;;
              random) tag="ランダム" ;;
              sniffer_egg) tag="スニファーの卵" ;;
              step) tag="足音" ;;
              tile) tag="タイル" ;;
              ui) tag="UI" ;;
              vr) tag="VR" ;;
              *) tag="$rawTag" ;;
            esac

            if [ "$first" = true ]; then
              first=false
            else
              echo "," >> "$OUT"
            fi

            echo "  {" >> "$OUT"
            echo "    \"name\": \"$name\"," >> "$OUT"
            echo "    \"path\": \"$file\"," >> "$OUT"
            echo "    \"tag\": \"$tag\"," >> "$OUT"
            echo "    \"rawTag\": \"$rawTag\"" >> "$OUT"
            echo "  }" >> "$OUT"

          done < <(find "$ROOT" -type f -name "*.mp3" | sort)

          echo "]" >> "$OUT"

      - name: Commit JSON
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add data/sounds.json
          git commit -m "auto: update sounds.json" || echo "no changes"
          git push
